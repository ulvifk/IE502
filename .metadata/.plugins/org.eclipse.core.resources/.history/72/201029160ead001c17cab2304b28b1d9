import java.io.IOException;
import java.util.ArrayList;
import java.util.Locale;

import gurobi.GRB;
import gurobi.GRBConstr;
import gurobi.GRBEnv;
import gurobi.GRBException;
import gurobi.GRBModel;
import gurobi.GRBVar;

public class Model {
	GRBModel model;
	Variables variables;
	
	public Model(Network network) throws GRBException, IOException {
		GRBEnv env = new GRBEnv();
		this.model = new GRBModel(env);
		
		this.variables = new Variables(network, model);
		Objective obj = new Objective(model, variables, network);
		Constraints constraints = new Constraints(model, network, variables);
		this.model.optimize();
		
		this.model.write("Model.lp");
		if(this.model.get(GRB.IntAttr.Status) == GRB.INFEASIBLE) {
			this.model.computeIIS();
			
			for(GRBConstr c : this.model.getConstrs()) {
				if(c.get(GRB.IntAttr.IISConstr) == 1) {
					System.out.println(c.get(GRB.StringAttr.ConstrName));
				}
			}
		}
		for(Drone v : this.variables.getY().keySet()) {
			for(Node i : this.variables.getY().get(v).keySet()) {
				for(Node j : this.variables.getY().get(v).get(i).keySet()) {
					for(Node k : this.variables.getY().get(v).get(i).get(j).keySet()) {
						GRBVar y = this.variables.getY().get(v).get(i).get(j).get(k);
						double yValue = y.get(GRB.DoubleAttr.X);
						if(yValue > 0.5) System.out.println(yValue);
					}
				}
			}
		}
		
		WriteData writeData = new WriteData(network, variables);
		
		this.model.dispose();
		env.dispose();
	}

}
